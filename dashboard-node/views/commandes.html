<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Commandes – Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/style.css">
</head>
<body class="flex bg-gray-100">

<aside class="w-64 bg-[#007A3D] text-white fixed h-screen p-6">
<h2 class="text-xl font-bold mb-6">Dashboard</h2>
<ul>
<li class="mb-3"><a href="/" class="flex items-center gap-2"><i class="fas fa-home"></i> Tableau de bord</a></li>
<li class="mb-3"><a href="/mets" class="flex items-center gap-2"><i class="fas fa-utensils"></i> Mets</a></li>
<li class="mb-3"><a href="/regions" class="flex items-center gap-2"><i class="fas fa-map-marker-alt"></i> Régions</a></li>
<li class="mb-3"><a href="/commandes" class="flex items-center gap-2"><i class="fas fa-shopping-cart"></i> Commandes</a></li>
<li class="mb-3"><a href="/contacts" class="flex items-center gap-2"><i class="fas fa-envelope"></i> Contacts</a></li>
</ul>
</aside>

<main class="ml-64 p-6 flex-1">
<h1 class="text-2xl font-bold mb-4">Commandes</h1>

<div class="bg-white p-4 rounded-lg shadow">
<table class="min-w-full border">
<thead class="bg-gray-200">
<tr>
<th class="p-2">Utilisateur</th>
<th class="p-2">Met</th>
<th class="p-2">Quantité</th>
<th class="p-2">Total</th>
<th class="p-2">Date</th>
<th class="p-2">Actions</th>
</tr>
</thead>
<tbody id="commandes-tbody"></tbody>
</table>
</div>
</main>

<script>
const API_BASE = '';

async function fetchJson(url, opts={}) {
    try { return (await axios(url, opts)).data; }
    catch(err){ console.error(err); return []; }
}

async function loadCommandes() {
    const commandes = await fetchJson('/api/commandes');
    const tbody = document.getElementById('commandes-tbody');
    tbody.innerHTML = '';
    commandes.forEach(c => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td class="p-2 text-center">${c.utilisateur_nom || c.utilisateur}</td>
            <td class="p-2 text-center">${c.met_nom || c.met}</td>
            <td class="p-2 text-center">${c.quantite}</td>
            <td class="p-2 text-center">${c.total} FCFA</td>
            <td class="p-2 text-center">${c.date_commande}</td>
            <td class="p-2 flex gap-2 justify-center">
                <button class="bg-red-600 text-white px-2 rounded" onclick="deleteCommande(${c.id})"><i class="fas fa-trash-alt"></i></button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function deleteCommande(id) {
    if(!confirm('Confirmer la suppression ?')) return;
    await fetchJson(`/api/commandes/${id}`, { method:'DELETE' });
    loadCommandes();
}

// Initial load
window.onload = loadCommandes;
</script>

</body>
</html>
